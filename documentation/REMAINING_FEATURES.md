# Remaining Features After 5G Removal

## Overview

After removing 5G support, the system now has **269 total features** (down from 270):
- **13 numeric features** (network metrics)
- **128 embedding features** (current chunk)
- **128 embedding features** (context from similar past chunks)

## Feature Breakdown

### 1. Numeric Network Features (13 total)

These are the primary network metrics used for AI decision making:

| # | Feature | Type | Description | Range/Values |
|---|---------|------|-------------|--------------|
| 1 | `rtt_ms` | f32 | Round-trip time in milliseconds | 0.0 - 10000.0 |
| 2 | `jitter_ms` | f32 | Jitter (packet delay variation) in ms | 0.0 - 1000.0 |
| 3 | `loss_rate` | f32 | Packet loss rate (0.0 = no loss, 1.0 = 100% loss) | 0.0 - 1.0 |
| 4 | `throughput_mbps` | f32 | Network throughput in megabits per second | 0.0 - 1000.0 |
| 5 | `retransmissions` | f32 | Number of packet retransmissions | 0.0 - 100.0 |
| 6 | `queue_p0` | f32 | Queue depth for priority 0 (high priority) | 0.0 - 1000.0 |
| 7 | `queue_p1` | f32 | Queue depth for priority 1 (medium priority) | 0.0 - 1000.0 |
| 8 | `queue_p2` | f32 | Queue depth for priority 2 (low priority) | 0.0 - 1000.0 |
| 9 | `p0_rate` | f32 | Transmission rate for priority 0 (bytes/sec) | 0.0 - 10000.0 |
| 10 | `p1_rate` | f32 | Transmission rate for priority 1 (bytes/sec) | 0.0 - 10000.0 |
| 11 | `p2_rate` | f32 | Transmission rate for priority 2 (bytes/sec) | 0.0 - 10000.0 |
| 12 | `wifi_signal` | f32 | WiFi signal strength in dBm | -100.0 to -30.0 |
| 13 | `starlink_latency` | f32 | Starlink network latency in milliseconds | 20.0 - 100.0 |

**Note:** The following fields exist in `NetworkMetricsInput` but are **NOT** included in the 13 numeric features sent to the model:
- `session_state` - Used for network quality assessment, not model input
- `retries` - Used for retry logic, not model input
- `chunk_size` - Used for post-processing, not model input

### 2. Embedding Features (256 total)

#### Current Chunk Embedding (128 features)
- **Source**: Generated by `embedder.onnx` model
- **Input**: Raw telemetry chunk bytes
- **Output**: 128-dimensional vector representing semantic meaning of current data
- **Purpose**: Captures the content/meaning of the current telemetry chunk

#### Context Embedding (128 features)
- **Source**: Retrieved from vector store (HNSW/SimpleVectorStore)
- **Method**: Nearest neighbor search using current embedding
- **Purpose**: Provides context from similar past situations
- **Usage**: Helps AI make decisions based on historical patterns

### 3. File Transfer Features (8 features - Post-processing only)

These features exist in `AiInput` but are **NOT** sent to the ONNX model. They're used for post-processing decisions:

| Feature | Type | Description |
|---------|------|-------------|
| `file_size` | f32 | Total file size in bytes (0.0 if not a file transfer) |
| `file_type` | f32 | File type (0=Media, 1=Document, 2=Data, 3=Archive, 4=Binary, 5=Unknown) |
| `file_priority` | f32 | File priority (0=Critical, 1=High, 2=Normal, 3=Low) |
| `transfer_progress` | f32 | Transfer progress (0.0-1.0, 1.0 = complete) |
| `bytes_transferred` | f32 | Bytes already transferred |
| `requires_integrity_check` | f32 | Whether integrity check is required (1.0=yes, 0.0=no) |
| `integrity_check_failures` | f32 | Number of failed integrity checks (0.0+) |
| `is_resume` | f32 | Whether this is a resume/retry (1.0=yes, 0.0=no) |

## Feature Vector Structure

```
Total: 269 features
├── Numeric Features (13)
│   ├── Network Performance (5): rtt_ms, jitter_ms, loss_rate, throughput_mbps, retransmissions
│   ├── Queue Metrics (3): queue_p0, queue_p1, queue_p2
│   ├── Rate Metrics (3): p0_rate, p1_rate, p2_rate
│   └── Network Signals (2): wifi_signal, starlink_latency
│
├── Current Embedding (128)
│   └── Semantic representation of current telemetry chunk
│
└── Context Embedding (128)
    └── Semantic representation of similar past situation
```

## Model Input/Output

### Input to ONNX Model
- **Shape**: `(1, 269)`
- **Features**: 13 numeric + 128 current embedding + 128 context embedding

### Output from ONNX Model
- **Shape**: `(1, 7)`
- **Values**:
  1. Route decision (0=WiFi, 1=Starlink, 2=Multipath)
  2. Severity (0=High, 1=Low)
  3. P2 enable (0.0=disabled, 1.0=enabled)
  4. Congestion predicted (0.0=no, 1.0=yes)
  5. WFQ P0 weight (percentage)
  6. WFQ P1 weight (percentage)
  7. WFQ P2 weight (percentage)

## Network Metrics Input Structure

```rust
pub struct NetworkMetricsInput {
    // Core network metrics
    pub rtt_ms: f32,
    pub jitter_ms: f32,
    pub loss_rate: f32,
    pub throughput_mbps: f32,
    pub retransmissions: f32,
    
    // Queue metrics
    pub queue_p0: f32,
    pub queue_p1: f32,
    pub queue_p2: f32,
    
    // Rate metrics
    pub p0_rate: f32,
    pub p1_rate: f32,
    pub p2_rate: f32,
    
    // Network signals (5G removed)
    pub wifi_signal: f32,
    pub starlink_latency: f32,
    
    // State/control (not sent to model)
    pub session_state: f32,  // 0=ACTIVE, 1=BREAK
    pub retries: f32,
}
```

## Routing Options

After removing 5G, the available routes are:

1. **WiFi (0)** - Default fallback
   - Uses `wifi_signal` for quality assessment
   - Best for local network connectivity

2. **Starlink (1)**
   - Uses `starlink_latency` for quality assessment
   - Best for remote/satellite connectivity

3. **Multipath (2)**
   - Uses multiple paths simultaneously
   - Best for redundancy and high throughput

## Feature Usage Summary

### Used in Model Inference (269 features)
- ✅ 13 numeric network features
- ✅ 128 current chunk embedding
- ✅ 128 context embedding

### Used for Post-Processing (not in model)
- ✅ File transfer metadata (8 features)
- ✅ `session_state` (network quality assessment)
- ✅ `chunk_size` (compression decisions)
- ✅ `retries` (retry strategy)

### Removed Features
- ❌ `fiveg_signal` - Completely removed from system

## Default Values

```rust
NetworkMetricsInput::default() {
    rtt_ms: 15.0,
    jitter_ms: 2.0,
    loss_rate: 0.001,
    throughput_mbps: 100.0,
    retransmissions: 0.0,
    queue_p0: 0.0,
    queue_p1: 0.0,
    queue_p2: 0.0,
    p0_rate: 0.0,
    p1_rate: 0.0,
    p2_rate: 0.0,
    wifi_signal: -50.0,        // Good signal
    starlink_latency: 40.0,     // Typical latency
    session_state: 0.0,         // ACTIVE
    retries: 0.0,
}
```

## Changes from Original

| Aspect | Before | After | Change |
|--------|--------|-------|--------|
| Numeric features | 14 | 13 | Removed `fiveg_signal` |
| Total features | 270 | 269 | -1 feature |
| Routing options | 4 (5G, WiFi, Starlink, Multipath) | 3 (WiFi, Starlink, Multipath) | Removed 5G |
| Signal metrics | 2 (wifi, 5g) | 1 (wifi) | Removed 5G signal |

## Summary

The system now focuses on **WiFi and Starlink** as the primary network paths, with **Multipath** as an option for redundancy. All 5G-related features have been completely removed, reducing the feature set from 270 to 269 features while maintaining full functionality for the remaining network types.

